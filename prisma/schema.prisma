generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "windows", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("PRIMARY_DATABASE_URL")
}


enum DeviceConnectionStatus {
  CONNECT
  DISCONNECT
}



model DeviceStatus { 
  imei      String                @id
  status    DeviceConnectionStatus
  updatedAt DateTime              @updatedAt 
  @@map("device_status") 
}

model CommandQueue {
  id        BigInt   @id @default(autoincrement())
  imei      String
  protocol  String
  command   String
  createdAt DateTime @default(now())

  @@index([imei])        
  @@map("command_queue") 
}

// =========================
// Devices / Sims
// =========================
model DeviceType {
  id               Int  @id @default(autoincrement())
  name             String
  port             Int
  manufacturer     String?
  protocol         String?
  firmwareVersion  String?

  devices          Device[]
  customCommands   CustomCommand[]

  @@map("device_types")
}


model Device {
  id           Int     @id @default(autoincrement())
  adminUserId   Int
  imei         String     @unique
  simId        Int?
  deviceTypeId Int?
  createdAt    DateTime   @default(now())

 adminUser     User       @relation("AdminUserDevices", fields: [adminUserId], references: [uid], onDelete: Restrict, onUpdate: Cascade)
  sim          Sim?        @relation(fields: [simId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  type         DeviceType? @relation(fields: [deviceTypeId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  vehicles     Vehicle[]

  @@index([adminUserId])
  @@index([simId])
  @@index([deviceTypeId])
  @@map("devices")
}
